---
title: "p8105_hw2_sl4655"
author: "Shuya Liu"
date: "October 2, 2019"
output: github_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
```

# _Problem 1_

### Read and clean the Mr. Trash Wheel sheet

```{r trash_wheel_data_input, message = FALSE}
## Read in Mr. Trash Wheel data
trash_wheel_data <- 
  readxl::read_excel(path = "./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
                     sheet = "Mr. Trash Wheel") %>%
  janitor::clean_names() %>%
  select(dumpster:homes_powered) %>%
  drop_na(dumpster) %>%
  mutate(sports_balls = round(sports_balls) %>% as.integer())
```

### Read and clean precipitation data for 2017 and 2018

```{r precipitaion}
precip_2017_data <- 
  readxl::read_excel(path = "./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
                     sheet = "2017 Precipitation",
                     range = "A2:B14") %>%
  janitor::clean_names() %>%
  drop_na(total) %>%
  mutate(year = 2017)

precip_2018_data <-
  readxl::read_excel(path = "./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
                     sheet = "2018 Precipitation",
                     range = "A2:B14") %>%
  janitor::clean_names() %>%
  drop_na(total) %>%
  mutate(year = 2018)
```

### Combine precipitation datasets

```{r combine}
precip_combine_data <-
  rbind(precip_2017_data, precip_2018_data) %>%
  select(year, month, precipitation = total) %>% 
  mutate(month = factor(month, labels = month.name))
```

```{r stats, include = FALSE}
## Descriptive Statistics
total_2017 = sum(with(precip_combine_data, subset(precipitation, year == 2017)))
total_2018 = sum(with(precip_combine_data, subset(precipitation, year == 2018)))
min_2017 = min(with(precip_combine_data, subset(precipitation, year == 2017)))
min_2018 = min(with(precip_combine_data, subset(precipitation, year == 2018)))
max_2017 = max(with(precip_combine_data, subset(precipitation, year == 2017)))
max_2018 = max(with(precip_combine_data, subset(precipitation, year == 2018)))
```

* **For precipitation data**:

  The total precipitation for year 2017 is `r total_2017`(in). The total precipitation for year 2018 is `r total_2018`(in). The difference is `r total_2018 - total_2017`(in). In year 2017, the smallest amount of precipitation `r min_2017`(in) occurred in `r with(precip_combine_data, subset(month, precipitation == min_2017))`, and the largest amount of precipitation `r max_2017`(in) occurred in `r with(precip_combine_data, subset(month, precipitation == max_2017))`. In year 2018, the smallest amount of precipitation `r min_2018`(in) occurred in `r with(precip_combine_data, subset(month, precipitation == min_2018))`, and the largest amount of precipitation `r max_2018`(in) occurred in `r with(precip_combine_data, subset(month, precipitation == max_2018))`.

* **For Mr. Trash Wheel data**:

  There are `r dim(trash_wheel_data)[1]` rows of data and `r dim(trash_wheel_data)[2]` variables, with `r sum(is.na(trash_wheel_data))` missing data. The data starts from `r min(trash_wheel_data$date)` to `r max(trash_wheel_data$date)`. The medians of plastic bottles, cigarette butts, grocery bags and sports balls for each year are shown as below:
  
```{r echo = FALSE}
aggregate(
  cbind(plastic_bottles, cigarette_butts, grocery_bags, sports_balls) ~ year, 
  data = trash_wheel_data, 
  median)
```

The total amount of weight(tons), and volume(cubic_yards), and homes powered for each year are shown as below:

```{r echo = FALSE}
aggregate(
  cbind(weight_tons, volume_cubic_yards, homes_powered) ~ year,
  data = trash_wheel_data,
  sum
)
```

# _Problem 2_

### Clean the data in pols-month.csv

```{r pols_month, message = FALSE}
pols_data <- 
  read_csv(file = "./data/fivethirtyeight_datasets/pols-month.csv") %>%
  janitor::clean_names() %>%
  separate(col = mon, into = c("year", "month", "day"), sep = "-") %>%
  mutate(month = factor(month, labels = month.name),
         president = factor(prez_gop, levels = c(0,1), labels = c("dem", "gop"))) %>%
  select(year:day, president, everything(), -prez_dem, -prez_gop, -day)
```

### Clean the data in snp.csv

```{r snp, message = FALSE}
snp_data <- 
  read_csv(file = "./data/fivethirtyeight_datasets/snp.csv") %>%
  janitor::clean_names() %>%
  mutate(date = as.Date(date, "%m / %d / %y")) %>%
  separate(col = date, into = c("year", "month", "day"), sep = "-") %>%
  mutate(month = factor(month, labels = month.name)) %>%
  select(year, month, snp_close = close) %>%
  arrange(year, month)

```

### Tidy the unemployment data

```{r umemployment, message = FALSE}
unemploy_data <- 
  read_csv(file = "./data/fivethirtyeight_datasets/unemployment.csv") %>%
  janitor::clean_names() %>%
  pivot_longer(
    jan:dec, 
    names_to = "month",
    values_to = "unemploy_rate") %>%
  mutate(month = 
           factor(month, 
                  levels = c("jan", "feb", "mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec"), 
                  labels = month.name),
         year = as.character(year))
```

###Join the datasets

```{r merge, massage = FALSE}
## First merge snp into pols
join1_data <- left_join(pols_data, snp_data, by = c("year", "month"))

## Next merge unemployment into the result
result_data <- left_join(join1_data, unemploy_data, by = c("year", "month"))
```

Join the datasets by merging snp into pols, and merging unemployment into the result.

Write a short paragraph about these datasets. Explain briefly what each dataset contained, and describe the resulting dataset (e.g. give the dimension, range of years, and names of key variables).

Note: we could have used a date variable as a key instead of creating year and month keys; doing so would help with some kinds of plotting, and be a more accurate representation of the data. Date formats are tricky, though. For more information check out the lubridate package in the tidyverse.